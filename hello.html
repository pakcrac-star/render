<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Adaptive 3D Flower Benchmark</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #03040a;
    font-family: monospace;
    color: #fff;
  }
  canvas { display: block; width: 100%; height: 100%; }
  #gpuBox, #cpuBox, #centerScore {
    position: absolute;
    background: rgba(0, 0, 0, 0.55);
    padding: 12px;
    border-radius: 10px;
    backdrop-filter: blur(4px);
  }
  #gpuBox { left: 10px; top: 10px; }
  #cpuBox { right: 10px; top: 10px; }
  #centerScore {
    left: 50%; top: 50%; transform: translate(-50%, -50%);
    padding: 20px; text-align: center; background: rgba(0,0,0,0.6);
  }
  #centerScore div:nth-child(1) { font-size: 26px; font-weight: bold; }
  #centerScore div:nth-child(2) { font-size: 38px; margin-top: 8px; }
</style>
</head>
<body>
<canvas id="app"></canvas>
<div id="gpuBox">GPU: <span id="gpuFPS">0</span> FPS<br>Score: <span id="gpuScore">0</span><br>n: <span id="gpuN">1</span></div>
<div id="cpuBox">CPU: <span id="cpuFPS">0</span> FPS<br>Score: <span id="cpuScore">0</span><br>n: <span id="cpuN">1</span></div>
<div id="centerScore"><div>Combined Score</div><div id="combined">0</div></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r152/three.min.js"></script>
<script>
// === Setup Renderer & Scene ===
const canvas = document.getElementById('app');
const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(devicePixelRatio);

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(55, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0, 0, 10);
camera.lookAt(0, 0, 0);

// === Lights ===
const hemi = new THREE.HemisphereLight(0xffffff, 0x444444, 0.8);
scene.add(hemi);
const dir = new THREE.DirectionalLight(0xffffff, 0.6);
dir.position.set(5,10,7);
scene.add(dir);

// === Flower Group ===
let flower = new THREE.Group();
scene.add(flower);

// === Make Petal ===
function makePetal(angle, scale=1){
  const shape = new THREE.Shape();
  shape.moveTo(0,0);
  shape.quadraticCurveTo(0.5,1.2,0,2.0);
  shape.quadraticCurveTo(-0.5,1.2,0,0);

  const geo = new THREE.ExtrudeGeometry(shape, { depth: 0.15, bevelEnabled: false });
  geo.scale(1.2*scale, 1.2*scale, 1);

  const mat = new THREE.MeshStandardMaterial({
    color: new THREE.Color(`hsl(${angle%360},70%,60%)`),
    metalness: 0.2,
    roughness: 0.35
  });

  const mesh = new THREE.Mesh(geo, mat);
  mesh.rotation.z = (angle*Math.PI)/180;
  return mesh;
}

// === Build Flower ===
function buildFlower(petals){
  while(flower.children.length) flower.remove(flower.children[0]);
  for(let i=0;i<petals;i++){
    const angle = (i/petals)*360;
    const p = makePetal(angle, 1);
    const rad = 3;
    p.position.x = Math.cos(angle*Math.PI/180)*rad;
    p.position.y = Math.sin(angle*Math.PI/180)*rad;
    flower.add(p);
  }
  // Center Sphere
  const center = new THREE.Mesh(
    new THREE.SphereGeometry(0.3,16,12),
    new THREE.MeshStandardMaterial({color:0xffdd55})
  );
  flower.add(center);
}

// === GPU Load ===
let gpuN = 1, gpuFrames = 0, lastGPU = performance.now(), gpuFPS=0, gpuScore=0;
function updateGPU(now){
  gpuFrames++;
  if(now - lastGPU >= 1000){
    gpuFPS = gpuFrames;
    gpuScore = Math.round(gpuFPS * (navigator.hardwareConcurrency||1));
    gpuFrames = 0;
    lastGPU = now;
    if(gpuFPS > 45) gpuN++;
    buildFlower(Math.min(Math.pow(2, gpuN), 256));
  }
}

// === CPU Load ===
let cpuN = 1, cpuFrames = 0, lastCPU = performance.now(), cpuFPS=0, cpuScore=0;
function cpuLoad(n){
  let s=0;
  const lim = Math.floor(Math.pow(2,n)/8);
  for(let i=0;i<lim;i++) s+=Math.sqrt(i);
}
function updateCPU(now){
  cpuFrames++;
  if(now - lastCPU >= 1000){
    cpuFPS = cpuFrames;
    cpuScore = Math.round(cpuFPS * (navigator.hardwareConcurrency||1) * (navigator.deviceMemory||1));
    cpuFrames = 0;
    lastCPU = now;
    if(cpuFPS > 20) cpuN++;
  }
  cpuLoad(cpuN);
}

// === Animate ===
function animate(now){
  requestAnimationFrame(animate);
  updateGPU(now);
  updateCPU(now);
  flower.rotation.z += 0.002;
  renderer.render(scene,camera);

  document.getElementById('gpuFPS').textContent = gpuFPS;
  document.getElementById('gpuScore').textContent = gpuScore;
  document.getElementById('gpuN').textContent = gpuN;
  document.getElementById('cpuFPS').textContent = cpuFPS;
  document.getElementById('cpuScore').textContent = cpuScore;
  document.getElementById('cpuN').textContent = cpuN;
  document.getElementById('combined').textContent = gpuScore + cpuScore;
}

// === Start ===
buildFlower(2);
animate();

// === Resize ===
window.addEventListener('resize', ()=>{
  renderer.setSize(window.innerWidth, window.innerHeight);
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
});
</script>
</body>
</html>
